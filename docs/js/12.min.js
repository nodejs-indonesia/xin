(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{47:function(t,e,i){"use strict";i.r(e);var s=i(7),r=i(0),a=i(5);class n{static routeRegExp(t){let e=t.split("[");if(e.length>2)throw new Error("Invalid use of optional params");let i=[],s=e[0].replace(/{([^}]+)}/g,function(t,e){return i.push(e),"([^/]+)"}).replace(/\//g,"\\/"),r="";return e[1]&&(r="(?:"+e[1].slice(0,-1).replace(/{([^}]+)}/g,function(t,e){let[s,r="[^/]+"]=e.split(":");return i.push(s),`(${r})`}).replace(/\//g,"\\/")+")?"),[new RegExp("^"+s+r+"$"),i]}static isStatic(t){return!t.match(/[[{]/)}constructor(t,e){if(this.route=t,this.callback=e,n.isStatic(t))this.type="s",this.pattern=null,this.args=[];else{let e=n.routeRegExp(t);this.type="v",this.pattern=e[0],this.args=e[1]}}getExecutorFor(t){if("s"===this.type){if(t===this.route)return{handler:this,args:{}}}else if("v"===this.type){let e=t.match(this.pattern);if(e)return{handler:this,args:this.args.reduce((t,i,s)=>(t[i]=e[s+1],t),{})}}}}const o=i(4)("xin:components:app");class h extends a.a{get props(){return{title:{type:String,observer:"_titleChanged"},manual:{type:Boolean},mode:{type:String,value:"hash"},rootUri:{type:String,value:"/"},hash:{type:String,value:"#!"},startDelay:{type:Number,value:100},location:{type:Object,value:()=>window.location},history:{type:Object,value:()=>window.history}}}get hashRegexp(){return this._hashRegexp&&this._hash===this.hash||(this._hashRegexp=new RegExp(`${this.hash}(.*)$`),this._hash=this.hash),this._hashRegexp}notFound(t){console.warn(`Route not found: ${t}`)}_titleChanged(t){t&&(document.title=t)}created(){this.__appSignature=!0,this.handlers=[],this.middlewares=[],this.__started=!1,this.__starting=!1,this.classList.add("xin-app")}attached(){this.manual||this.async(()=>{this.start()},1)}detached(){super.detached(),"history"===this.mode?(Object(r.c)(window).off("popstate",this.__navCallback),Object(r.c)(document).off("click",this.__clickCallback),delete this.__clickCallback):Object(r.c)(window).off("hashchange",this.__navCallback),delete this.__navCallback}route(t,e){this.handlers.push(new n(t,e))}async start(){if(this.__started||this.__starting)return;this.__middlewareChainRun=function(t){for(let e of t)if("function"!=typeof e)throw new TypeError("Middleware must be composed of functions!");return(e,i)=>{let s=-1;return function r(a){if(a<=s)throw new Error("next() called multiple times");s=a;let n=t[a];a===t.length&&(n=i);if(!n)return;return n(e,()=>r(a+1))}(0)}}(this.middlewares),this.__listenNavigation(),o(`Starting ${this.is}:${this.__id} ...`),this.__starting=!0;let t=await this.__execute();this.async(()=>{this.__starting=!1,t&&(o(`Started ${this.is}:${this.__id}`),this.__started=!0,this.fire("started"))},this.startDelay)}__listenNavigation(){this.__navCallback=(()=>{this.__execute()}),"history"===this.mode?(this.__clickCallback=(t=>{if(!t.defaultPrevented&&"A"===t.target.nodeName&&""===t.target.target){t.preventDefault();let e={url:t.target.getAttribute("href")};this.history.pushState(e,t.target.innerHTML,t.target.href),this.__navCallback()}}),Object(r.c)(window).on("popstate",this.__navCallback),Object(r.c)(document).on("click",this.__clickCallback)):Object(r.c)(window).on("hashchange",this.__navCallback)}get started(){return this.__started||!1}getFragmentExecutors(t){return this.handlers.reduce((e,i)=>{let s=i.getExecutorFor(t);return s&&e.push(s),e},[])}async __execute(){let t=this.getFragment(),e={app:this,uri:t};return!1!==await this.__middlewareChainRun(e,()=>{let i=this.getFragmentExecutors(e.uri);if(0===i.length)return this.notFound(t),void this.fire("route-not-found",t);i.forEach(t=>{t.handler.callback(t.args,e)})})&&(this.fire("navigated",e),!0)}navigate(t,e){if(t=t||"/",e=e||{},"history"===this.mode){let i=this.rootUri+t.toString().replace(/\/$/,"").replace(/^\//,"");this.location.href.replace(this.location.origin,"")!==i&&(this.history[e.replace?"replaceState":"pushState"]({},document.title,i),this.__execute())}else e.replace?this.location.replace(this.hash+t):this.location.hash=this.hash+t;return this}use(t){this.middlewares.push(t)}getFragment(){try{let t;if("history"===this.mode)t=(t=decodeURI(this.location.pathname+this.location.search)).replace(/\?(.*)$/,""),t="/"===this.rootUri?t:t.replace(this.rootUri,"");else{let e=this.location.href.match(this.hashRegexp);t=e?e[1]:""}return"/"+t.toString().replace(/\/$/,"").replace(/^\//,"")}catch(t){return console.error("Fragment is not match any pattern, fallback to /"),"/"}}}Object(a.c)("xin-app",h);var l=i(3);Object(a.c)("xin-fixture",class extends a.a{static create(t,e={}){const i=document.createElement("div");i.innerHTML=`<xin-fixture><template>${t}</template></xin-fixture>`;const s=i.firstElementChild;return s.__initialData=e,document.body.appendChild(s),new Promise(t=>t(s))}attached(){super.attached(),this.set(this.__initialData),this.connected=!0,this.async(()=>this.fire("connected"))}detached(){super.detached(),this.connected=!1,this.fire("disconnected")}dispose(){this.parentElement.removeChild(this)}async waitConnected(t){this.connected||await this.waitFor("connected"),await l.a.sleep(t)}});class c extends a.a{attached(){super.attached(),this.__app.use(this.callback())}}Object(a.c)("xin-pager",class extends a.a{ready(){super.ready();for(let t=this.firstElementChild,e=0;t;t=t.nextElementSibling,e++)t.setAttribute("index",e)}setFocus(t){if(t){let e=t.getAttribute("index"),i=this.focused$?this.focused$.getAttribute("index"):-1;i<e?this.__transitionForward(this.focused$,t):i>e&&this.__transitionBackward(this.focused$,t)}else this.focused$&&this.focused$.setFocus(!1);this.focused$=t}__transitionBackward(t,e){Promise.all([e.inFx.play(-1),t.outFx.play(-1)]).then(()=>{t.setVisible(!1),e.setVisible(!0),t.setFocus(!1),e.setFocus(!0),this.$focused=e,e.inFx.stop(),t.outFx.stop()})}__transitionForward(t,e){if(t)Promise.all([e.inFx.play(1),t.outFx.play(1)]).then(()=>{t.setVisible(!1),e.setVisible(!0),t.setFocus(!1),e.setFocus(!0),this.$focused=e,e.inFx.stop(),t.outFx.stop()});else{let t=new r.a({element:e,transition:"none"});t.play("in",1).then(()=>{e.setVisible(!0),e.setFocus(!0),this.$focused=e,t.stop()})}}});class d extends a.b{constructor(t,e,i,s){super(),this.__templateInitialize(t,e.__templateModel,e.__templateMarker),this.is="$repeat-row",this.__id=this.__templateId,this.__repeat=e,this.__repeatAs=e.as,this.__repeatIndexAs=e.indexAs,this.__templateChildNodes.forEach(t=>{t.nodeType===window.Node.ELEMENT_NODE&&(t.__repeatModel=this)}),this.update(i,s),this.__templateRender()}get __app(){return this.__templateHost.__app}update(t,e){this[this.__repeatAs]=t,this[this.__repeatIndexAs]=e,this.notify(this.__repeatAs,t),this.notify(this.__repeatIndexAs,e)}set(t,e){return(t=this.__templateGetPathAsArray(t))[0]===this.__repeatAs||t[0]===this.__repeatIndexAs?super.set(t,e):this.__templateHost.set(t,e)}get(t){return(t=this.__templateGetPathAsArray(t))[0]===this.__repeatAs||t[0]===this.__repeatIndexAs?super.get(t):this.__templateHost.get(t)}notify(t,e){return(t=this.__templateGetPathAsArray(t))[0]===this.__repeatAs||t[0]===this.__repeatIndexAs?super.notify(t,e):this.__templateHost.notify(t,e)}}const u=()=>!0;Object(a.c)("xin-for",class extends a.a{get props(){return Object.assign({},super.props,{items:{type:Array,observer:"_itemsChanged(items, filter)"},as:{type:String,value:"item"},indexAs:{type:String,value:"index"},filter:{type:Function,observer:"_itemsChanged(items, filter)"},to:{type:String,value:""}})}created(){super.created(),this.rows=[]}__initTemplate(){if(this.__templateFor=this.firstElementChild,!this.__templateFor)throw new Error('Invalid xin-for definition, must be <xin-for items="[[items]]"><template>...</template></xin-for>');this.removeChild(this.__templateFor);let t=this,e=this.getAttribute("to");if(e){let i=this.parentElement.querySelector(e)||document.querySelector(e);if(!i)throw new Error(`xin-for render to unknown element ${e}`);t=document.createComment("marker-for"),i.appendChild(t)}a.b.prototype.__templateInitialize.call(this,null,this,t)}_itemsChanged(t,e){this.debounce("_itemsChanged",()=>{let e=0;if(t&&t.length){let i=this.filter||u;t.filter(i).forEach((t,i)=>{this.rows[i]?this.rows[i].update(t,i):this.rows.push(new d(this.__templateFor,this,t,i)),e++})}this.rows.splice(e).forEach(t=>{t.__templateUninitialize()})})}itemForElement(t){return this.modelForElement(t).get(this.as)}indexForElement(t){return this.modelForElement(t).get(this.indexAs)}modelForElement(t){for(;t&&!t.__repeatModel;)t=t.parentElement;return t.__repeatModel}});i(6);class p{constructor(t,e,i){this.name=e.nodeName.toLowerCase(),this.uri=e.getAttribute("uri"),this.element=e,this.loader=i,this.route=new n(this.uri),this.isStaticRoute=n.isStatic(this.uri),this.bag=t}get loaded(){if(this._loaded)return!0;return this.element.classList.contains("xin-view")?(this._loaded=!0,!0):void 0}async load(){if(!this.loaded){if(!this.loader)throw new Error(`Cannot lazy load view: ${this.name}`);this.loader.load(this),await Object(r.c)(this.element).waitFor("routed"),this._loaded=!0,this.element.querySelector(".xin-view")&&await l.a.sleep(300)}}}Object(a.c)("xin-lazy-view-middleware",class extends c{get props(){return Object.assign({},super.props,{loaders:{type:Array,value:()=>this.__repository.get("view.loaders")?this.__repository.get("view.loaders"):[]}})}created(){super.created(),this.views=[]}attached(){super.attached(),this.loaders.push({test:/^xin-/,load(t){if("xin-view"===t.name)return Promise.resolve().then(i.bind(null,6))}})}get(t){let e=this.views.find(e=>e.uri===t);return e||this.views.find(e=>!(!e.isStaticRoute||e.uri!==t)||e.route.getExecutorFor(t))}put(t){this.views.push(t)}ensure(t,e){0===this.views.length&&t.querySelectorAll("[lazy-view]").forEach(t=>{let e=this.loaders.find(e=>t.nodeName.toLowerCase().match(e.test)),i=new p(this,t,e);this.put(i)});let i=this.get(e);if(i)return i.load()}callback(t){const e=this;return async function(t,i){await e.ensure(t.app,t.uri),await i()}}});Object(a.c)("xin-title-middleware",class extends c{get props(){return Object.assign({},super.props,{defaultTitle:{type:String,value:"Unknown"}})}callback(t){const e=this;return async function(t,i){t.app.once("focus",t=>{document.title=t.target.title||e.defaultTitle}),await i()}}});Object(s.b)("x-redirect-middleware",class extends c{callback(t){return async function(t,e){-1===[...document.querySelector("xin-pager").children].map(t=>t.getAttribute("uri")).indexOf(t.uri)&&(t.uri="/not-found"),await e()}}});Object(s.b)("x-app",class extends h{get template(){return i(48)}})},48:function(t,e){t.exports="<x-redirect-middleware></x-redirect-middleware> <xin-lazy-view-middleware></xin-lazy-view-middleware> <xin-pager> <xin-view lazy-view uri=/ > <template> <div class=padding> <h1>xin</h1> <p>A WebComponents based framework. We love npm, webpack and ofcourse webcomponents specs.</p> <div class=list> <a href=#!/intro>Intro</a> <a href=#!/binding>Binding</a> <a href=#!/app-route>App, views and routing</a> <a href=#!/component>Component</a> <a href=#!/middleware>Middleware</a> <div class=list__separator>Components</div> <a href=#!/fixture>xin-fixture</a> <a href=#!/for>xin-for</a> <div class=list__separator>Advanced</div> <a href=#!/advanced>Advanced topics</a> </div> </div> </template> </xin-view> <x-intro lazy-view uri=/intro></x-intro> <x-binding lazy-view uri=/binding></x-binding> <x-app-route lazy-view uri=/app-route></x-app-route> <x-component lazy-view uri=/component></x-component> <x-middleware lazy-view uri=/middleware></x-middleware> <x-for lazy-view uri=/for></x-for> <xin-view lazy-view uri=/advanced> <div class=padding> <h2>Advanced topics</h2> <h3>Defer</h3> <ul> <li>Async</li> <li>Debounce</li> <li>NextFrame</li> </ul> <h3>Events</h3> <ul> <li>component.fire()</li> <li>component.on()</li> </ul> </div> </xin-view> <xin-view lazy-view uri=/not-found> <div class=aligner> <div class=aligner-item> <p> Oops, route not found. Sorry... </p> <a href=#!/ >Home</a> </div> </div> </xin-view> </xin-pager> "},6:function(t,e,i){"use strict";i.r(e);var s=i(5),r=i(0);class a extends s.a{get props(){const t=this.__repository.get("view.transitionIn")||this.__repository.get("view.transition")||"slide",e=this.__repository.get("view.transitionOut")||this.__repository.get("view.transition")||"fade";return Object.assign({},super.props,{uri:{type:String,required:!0},transitionIn:{type:String,value:t},transitionOut:{type:String,value:e}})}focusing(){}focused(){}blurred(){}created(){super.created(),this.classList.add("xin-view")}ready(){super.ready(),this.inFx=new r.a({element:this,transition:this.transitionIn,method:"in"}),this.outFx=new r.a({element:this,transition:this.transitionOut,method:"out"})}attached(){super.attached(),this.classList.remove("xin-view--focus"),this.classList.remove("xin-view--visible"),this.__app?(this.__app.route(this.uri,t=>{this.focus(t)}),this.fire("routed")):console.error("Cannot route view to undefined app")}async focus(t={}){this.set("parameters",t),await this.focusing(t),this.fire("focusing",t),this.async(()=>{"setFocus"in this.parentElement?this.parentElement.setFocus(this):(this.setVisible(!0),this.setFocus(!0))})}setVisible(t){if(t)return this.classList.add("xin-view--visible"),void this.fire("show",{view:this});this.classList.remove("xin-view--visible"),this.querySelectorAll(".xin-view.xin-view--visible").forEach(e=>e.setVisible(t)),this.fire("hide",{view:this})}async setFocus(t){if(t)return this.classList.add("xin-view--focus"),await this.focused(),void this.fire("focus",{view:this});this.classList.remove("xin-view--focus"),this.querySelectorAll(".xin-view.xin-view--focus").forEach(e=>{"setFocus"in e.parentElement?e.parentElement.setFocus(null):e.setFocus(t)}),await this.blurred(),this.fire("blur",{view:this})}}Object(s.c)("xin-view",a),i.d(e,"View",function(){return a})}}]);